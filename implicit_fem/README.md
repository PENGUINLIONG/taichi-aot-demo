# Taichi AOT Demo: Implicit FEM

This repo includes Taichi AOT demo for implicit FEM.

```
python/  # Taichi python script for implicit_fem
desktop/  # desktop demo
android/  # android demo
  app/
    src/
      main/
        assets/
          shaders/
            aot/  # generated by `python implicit_fem.py --aot` in python/
            render/  # shaders used in rendering
```

## Desktop Demo

```
export TAICHI_REPO_DIR=/path/github/taichi/
cd desktop
mkdir build
cd build && cmake .. && cmake --build . --config=Release
```

Or you can open `desktop` as folder in Visual Studio 2019+ for better debugging experience.

## Android Demo
If you are building Taichi with custom changes, make sure to copy the prebuilt `libtaichi_export_core.so` to: `app/src/main/jniLibs/arm64-v8a/`

```
export TAICHI_REPO_DIR=/path/github/taichi/
export ANDROID_SDK_ROOT=/path/to/Andriod/Sdk
cd android
ln -s ${TAICHI_REPO_DIR}/_skbuild/linux-x86_64-3.8/cmake-build/libtaichi_export_core.so app/src/main/jniLibs/arm64-v8a/
./gradlew assembleDebug
adb install ./app/build/outputs/apk/debug/app-debug.apk
```

Or you can open `android` in Android Studio Bumblebee Canary 13+ (2021.1.1.13+) for better debugging experience. Earlier releases have broken support for CMake object library and please refer to [this Android Studio issue](https://issuetracker.google.com/issues/198756433) for more information.

## Troubleshooting

- Note that if you built for the desktop demo first and then decide to cross-compile to android, the manual cleanup (`python setup.py clean`) is required. CMake cannot automatically adjust build directory from one build type to another. More details can be found at [this stackoverflow question](https://stackoverflow.com/questions/40528254/how-do-i-detect-that-i-am-cross-compiling-in-cmakelists-txt).

- Monitor Android logs

```
adb logcat -s "TaichiTest" "*:F" "AndroidRuntime" vulkan taichi VALIDATION
```
